<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.evergrande.qms.mapper.QmsUserMapper" >
  <resultMap id="BaseResultMap" type="com.evergrande.qms.model.QmsUser" >
    <id column="id"  property="id" jdbcType="VARCHAR" javaType="java.lang.String" />
    <result column="login_name" property="loginName" jdbcType="VARCHAR" javaType="java.lang.String" />
    <result column="password" property="password" jdbcType="VARCHAR" javaType="java.lang.String" />
    <result column="real_name" property="realName" jdbcType="VARCHAR" javaType="java.lang.String" />
    <result column="mobile" property="mobile" jdbcType="VARCHAR" javaType="java.lang.String" />
    <result column="email" property="email" jdbcType="VARCHAR" javaType="java.lang.String" />
    <result column="status" property="status" jdbcType="INTEGER" javaType="java.lang.Integer" />
    <result column="department" property="department" jdbcType="INTEGER" javaType="java.lang.Integer" />
    <result column="power_type" property="powerType" jdbcType="INTEGER" javaType="java.lang.Integer" />
    <result column="sys_power" property="sysPower" jdbcType="VARCHAR" javaType="java.lang.String" />
    <result column="is_admin" property="isAdmin" jdbcType="INTEGER" javaType="java.lang.Integer" />
    <result column="is_initial" property="isInitial" jdbcType="INTEGER" javaType="java.lang.Integer" />
    <result column="institute_code" property="instituteCode" jdbcType="VARCHAR" javaType="java.lang.String" />
    <result column="institute_name" property="instituteName" jdbcType="VARCHAR" javaType="java.lang.String" />
    <result column="create_user" property="createUser" jdbcType="VARCHAR" javaType="java.lang.String" />
    <result column="create_date" property="createDate" jdbcType="TIMESTAMP" javaType="java.util.Date" />
    <result column="update_user" property="updateUser" jdbcType="VARCHAR" javaType="java.lang.String" />
    <result column="update_date" property="updateDate" jdbcType="TIMESTAMP" javaType="java.util.Date" />
    <result column="is_led" property="isLed" jdbcType="INTEGER" javaType="java.lang.Integer" />
  </resultMap>

  <resultMap id="userResultMap" type="com.evergrande.qms.vo.QmsUserVo" >
      <id column="id"  property="id" jdbcType="VARCHAR" javaType="java.lang.String" />
      <result column="login_name" property="loginName" jdbcType="VARCHAR" javaType="java.lang.String" />
      <result column="password" property="password" jdbcType="VARCHAR" javaType="java.lang.String" />
      <result column="real_name" property="realName" jdbcType="VARCHAR" javaType="java.lang.String" />
      <result column="mobile" property="mobile" jdbcType="VARCHAR" javaType="java.lang.String" />
      <result column="email" property="email" jdbcType="VARCHAR" javaType="java.lang.String" />
      <result column="status" property="status" jdbcType="INTEGER" javaType="java.lang.Integer" />
      <result column="department" property="department" jdbcType="INTEGER" javaType="java.lang.Integer" />
      <result column="power_type" property="powerType" jdbcType="INTEGER" javaType="java.lang.Integer" />
      <result column="sys_power" property="sysPower" jdbcType="VARCHAR" javaType="java.lang.String" />
      <result column="is_admin" property="isAdmin" jdbcType="INTEGER" javaType="java.lang.Integer" />
      <result column="institute_code" property="instituteCode" jdbcType="VARCHAR" javaType="java.lang.String" />
      <result column="institute_name" property="instituteName" jdbcType="VARCHAR" javaType="java.lang.String" />
      <result column="role_id" property="roleId" jdbcType="VARCHAR" javaType="java.lang.String" />
      <result column="role_name" property="roleName" jdbcType="VARCHAR" javaType="java.lang.String" />
      <result column="is_initial" property="isInitial" jdbcType="INTEGER" javaType="java.lang.Integer" />
      <result column="is_led" property="isLed" jdbcType="INTEGER" javaType="java.lang.Integer" />
  </resultMap>
  <sql id="Base_Column_List" >
    id, login_name, password, real_name, mobile, email, status, department, power_type, sys_power, is_admin,
    create_user, create_date, update_user, update_date, institute_code, institute_name, is_led
  </sql>
  <sql id="User_Column_List" >
    t.id, t.login_name,t.password, t.real_name, t.mobile, t.email, t.status, t.department, t.power_type, t.sys_power, t.is_admin,
    t2.id as role_id, t2.name as role_name, t.institute_code, t.institute_name, t.is_initial, t.is_led
  </sql>
  <select id="findAllList" resultMap="userResultMap" parameterType="com.evergrande.qms.vo.QmsUserVo" >
    select
    <include refid="User_Column_List" />
    from qms_user t LEFT JOIN qms_user_role t1 ON t.id = t1.user_id
      LEFT JOIN qms_role t2 ON t2.id = t1.role_id
    <where>
      <if test="roleId != null and roleId != ''">
        and t2.id = #{roleId}
      </if>
      <if test="powerType != null and powerType != ''">
        and t.power_type = #{powerType}
      </if>
      <if test="loginName != null and loginName != ''">
        and t.login_name like CONCAT('%','${loginName}','%' )
      </if>
      <if test="realName != null and realName != ''">
        and t.real_name like CONCAT('%','${realName}','%' )
      </if>
      <if test="status != null and status != ''">
        and t.status = #{status}
      </if>
      <if test="department != null and department != ''">
        and t.department = #{department}
      </if>
    </where>
    order by t.update_date DESC
  </select>
  <select id="findByLoginName" resultMap="userResultMap" parameterType="java.lang.String" >
    select
    <include refid="User_Column_List" />
    from qms_user t LEFT JOIN qms_user_role t1 ON t.id = t1.user_id
    LEFT JOIN qms_role t2 ON t2.id = t1.role_id
    where t.login_name = #{loginName,jdbcType=VARCHAR}
  </select>
  <select id="findSelectList" resultMap="userResultMap" parameterType="com.evergrande.qms.vo.QmsUserVo" >
    select
    <include refid="User_Column_List" />
    from qms_user t LEFT JOIN qms_user_role t1 ON t.id = t1.user_id
    LEFT JOIN qms_role t2 ON t2.id = t1.role_id
    <where>
      <if test="roleId != null and roleId != ''">
        and t2.id = #{roleId}
      </if>
      <if test="powerType != null and powerType != ''">
        and t.power_type = #{powerType}
      </if>
      <if test="loginName != null and loginName != ''">
        and t.login_name like CONCAT('%','${loginName}','%' )
      </if>
      <if test="realName != null and realName != ''">
        and t.real_name like CONCAT('%','${realName}','%' )
      </if>
      <if test="department != null and department != ''">
        and t.department = #{department}
      </if>
      <if test="status != null and status != ''">
        and t.status = #{status}
      </if>
      <if test="userIdList != null and userIdList.size > 0" >
        and t.id IN
        <foreach collection="userIdList" item="item" index="index" separator="," close=")" open="(">
          #{item,jdbcType=VARCHAR}
        </foreach>
      </if>
    </where>
  </select>
    <select id="findByUserId" resultMap="userResultMap" parameterType="java.lang.String" >
        select
        <include refid="User_Column_List" />
        from qms_user t LEFT JOIN qms_user_role t1 ON t.id = t1.user_id
        LEFT JOIN qms_role t2 ON t2.id = t1.role_id WHERE t.id = #{id,jdbcType=VARCHAR}
    </select>
  <select id="get" resultMap="BaseResultMap" parameterType="java.lang.String" >
    select
    <include refid="Base_Column_List" />
    from qms_user
    where id = #{id,jdbcType=VARCHAR}
  </select>
  <delete id="delete" parameterType="java.lang.String" >
    delete from qms_user
    where id = #{id,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="com.evergrande.qms.model.QmsUser" >
    insert into qms_user (id, login_name, password, 
      real_name, mobile, email, 
      status, department, power_type ,sys_power, is_admin, institute_code, institute_name,is_initial,
      create_user, create_date, update_user, 
      update_date,is_led)
    values (#{id,jdbcType=VARCHAR}, #{loginName,jdbcType=VARCHAR}, #{password,jdbcType=VARCHAR}, 
      #{realName,jdbcType=VARCHAR}, #{mobile,jdbcType=VARCHAR}, #{email,jdbcType=VARCHAR}, 
      #{status,jdbcType=INTEGER}, #{department,jdbcType=INTEGER}, #{powerType,jdbcType=INTEGER},#{sysPower,jdbcType=VARCHAR}, #{isAdmin,jdbcType=INTEGER},
      #{instituteCode,jdbcType=VARCHAR},#{instituteName,jdbcType=VARCHAR},#{isInitial,jdbcType=INTEGER},#{createUser,jdbcType=VARCHAR}, #{createDate,jdbcType=TIMESTAMP}, #{updateUser,jdbcType=VARCHAR},
      #{updateDate,jdbcType=TIMESTAMP},#{isLed,jdbcType=INTEGER})
  </insert>
    <insert id="batchAdd" parameterType="java.util.List" >
        insert into qms_user (id, login_name, password,
        real_name, mobile, email,
        status, department, power_type ,sys_power, institute_code, institute_name,is_initial,
        create_user, create_date, update_user,
        update_date)
        values
        <foreach collection="list" item="item" index="index" separator=",">
        (#{item.id,jdbcType=VARCHAR}, #{item.loginName,jdbcType=VARCHAR}, #{item.password,jdbcType=VARCHAR},
        #{item.realName,jdbcType=VARCHAR}, #{item.mobile,jdbcType=VARCHAR}, #{item.email,jdbcType=VARCHAR},
        #{item.status,jdbcType=INTEGER}, #{item.department,jdbcType=INTEGER}, #{item.powerType,jdbcType=INTEGER},#{item.sysPower,jdbcType=VARCHAR},
        #{item.instituteCode,jdbcType=VARCHAR},#{item.instituteName,jdbcType=VARCHAR},#{item.isInitial,jdbcType=INTEGER},#{item.createUser,jdbcType=VARCHAR}, #{item.createDate,jdbcType=TIMESTAMP}, #{item.updateUser,jdbcType=VARCHAR},
        #{item.updateDate,jdbcType=TIMESTAMP})
        </foreach>
    </insert>
  <insert id="add" parameterType="com.evergrande.qms.model.QmsUser" >
    insert into qms_user
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="loginName != null" >
        login_name,
      </if>
      <if test="password != null" >
        password,
      </if>
      <if test="realName != null" >
        real_name,
      </if>
      <if test="mobile != null" >
        mobile,
      </if>
      <if test="email != null" >
        email,
      </if>
      <if test="status != null" >
        status,
      </if>
      <if test="department != null" >
        department,
      </if>
      <if test="powerType != null" >
        power_type,
      </if>
      <if test="sysPower != null" >
        sys_power,
      </if>
      <if test="isAdmin != null" >
        is_admin,
      </if>
      <if test="instituteCode != null" >
        institute_code,
      </if>
      <if test="instituteName != null" >
        institute_name,
      </if>
      <if test="isInitial != null" >
        is_initial,
      </if>
      <if test="createUser != null" >
        create_user,
      </if>
      <if test="createDate != null" >
        create_date,
      </if>
      <if test="updateUser != null" >
        update_user,
      </if>
      <if test="updateDate != null" >
        update_date,
      </if>
      <if test="isLed != null" >
        is_led,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=VARCHAR},
      </if>
      <if test="loginName != null" >
        #{loginName,jdbcType=VARCHAR},
      </if>
      <if test="password != null" >
        #{password,jdbcType=VARCHAR},
      </if>
      <if test="realName != null" >
        #{realName,jdbcType=VARCHAR},
      </if>
      <if test="mobile != null" >
        #{mobile,jdbcType=VARCHAR},
      </if>
      <if test="email != null" >
        #{email,jdbcType=VARCHAR},
      </if>
      <if test="status != null" >
        #{status,jdbcType=INTEGER},
      </if>
      <if test="department != null" >
        #{department,jdbcType=INTEGER},
      </if>
      <if test="powerType != null" >
        #{powerType,jdbcType=INTEGER},
      </if>
      <if test="sysPower != null" >
        #{sysPower,jdbcType=VARCHAR},
      </if>
      <if test="isAdmin != null" >
        #{isAdmin,jdbcType=INTEGER},
      </if>
      <if test="instituteCode != null" >
        #{instituteCode,jdbcType=VARCHAR},
      </if>
      <if test="instituteName != null" >
        #{instituteName,jdbcType=VARCHAR},
      </if>
      <if test="isInitial != null" >
        #{isInitial,jdbcType=INTEGER},
      </if>
      <if test="createUser != null" >
        #{createUser,jdbcType=VARCHAR},
      </if>
      <if test="createDate != null" >
        #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="updateUser != null" >
        #{updateUser,jdbcType=VARCHAR},
      </if>
      <if test="updateDate != null" >
        #{updateDate,jdbcType=TIMESTAMP},
      </if>
      <if test="isLed != null" >
        #{isLed,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <update id="update" parameterType="com.evergrande.qms.model.QmsUser" >
    update qms_user
    <set >
      <if test="loginName != null" >
        login_name = #{loginName,jdbcType=VARCHAR},
      </if>
      <if test="password != null" >
        password = #{password,jdbcType=VARCHAR},
      </if>
      <if test="realName != null" >
        real_name = #{realName,jdbcType=VARCHAR},
      </if>
      <if test="mobile != null" >
        mobile = #{mobile,jdbcType=VARCHAR},
      </if>
      <if test="email != null" >
        email = #{email,jdbcType=VARCHAR},
      </if>
      <if test="status != null" >
        status = #{status,jdbcType=INTEGER},
      </if>
      <if test="department != null" >
        department = #{department,jdbcType=INTEGER},
      </if>
      <if test="powerType != null" >
        power_type = #{powerType,jdbcType=INTEGER},
      </if>
      <if test="sysPower != null" >
        sys_power = #{sysPower,jdbcType=VARCHAR},
      </if>
      <if test="isAdmin != null" >
        is_admin = #{isAdmin,jdbcType=INTEGER},
      </if>
      <if test="instituteCode != null" >
        institute_code = #{instituteCode,jdbcType=VARCHAR},
      </if>
      <if test="instituteName != null" >
        institute_name = #{instituteName,jdbcType=VARCHAR},
      </if>
      <if test="isInitial != null" >
          is_initial = #{isInitial,jdbcType=INTEGER},
      </if>
      <if test="createUser != null" >
        create_user = #{createUser,jdbcType=VARCHAR},
      </if>
      <if test="createDate != null" >
        create_date = #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="updateUser != null" >
        update_user = #{updateUser,jdbcType=VARCHAR},
      </if>
      <if test="updateDate != null" >
        update_date = #{updateDate,jdbcType=TIMESTAMP},
      </if>
      <if test="isLed != null" >
        is_led = #{isLed,jdbcType=INTEGER},
      </if>
    </set>
    where id = #{id,jdbcType=VARCHAR}
  </update>
  <update id="batchUpdateStatus" parameterType="com.evergrande.qms.model.QmsUser" >
    update qms_user
    set
    status = #{status,jdbcType=INTEGER},
    update_user = #{updateUser,jdbcType=VARCHAR},
    update_date = #{updateDate,jdbcType=TIMESTAMP}
    where id IN
    <foreach collection="userIdList" item="item" index="index" separator="," close=")" open="(">
      #{item,jdbcType=VARCHAR}
    </foreach>
  </update>
  <update id="updateByPrimaryKey" parameterType="com.evergrande.qms.model.QmsUser" >
    update qms_user
    set login_name = #{loginName,jdbcType=VARCHAR},
      password = #{password,jdbcType=VARCHAR},
      real_name = #{realName,jdbcType=VARCHAR},
      mobile = #{mobile,jdbcType=VARCHAR},
      email = #{email,jdbcType=VARCHAR},
      status = #{status,jdbcType=INTEGER},
      department = #{department,jdbcType=INTEGER},
      is_admin = #{isAdmin,jdbcType=INTEGER},
      institute_code = #{instituteCode,jdbcType=VARCHAR},
      institute_name = #{instituteName,jdbcType=VARCHAR},
      is_initial = #{isInitial,jdbcType=VARCHAR},
      create_user = #{createUser,jdbcType=VARCHAR},
      create_date = #{createDate,jdbcType=TIMESTAMP},
      update_user = #{updateUser,jdbcType=VARCHAR},
      update_date = #{updateDate,jdbcType=TIMESTAMP},
      is_led = #{isLed,jdbcType=INTEGER}
    where id = #{id,jdbcType=VARCHAR}
  </update>
  <update id="updateResetPassWord">
    update qms_user
    set password = #{passWord,jdbcType=VARCHAR},
    is_initial = 1,
    update_user = #{loginName,jdbcType=VARCHAR},
    update_date = #{updateDate,jdbcType=TIMESTAMP}
    where id IN
    <foreach collection="list" item="item" index="index" separator="," close=")" open="(">
      #{item,jdbcType=VARCHAR}
    </foreach>
  </update>

  <!-- 获取接样人信息 Add by laifuying -->
  <select id="findRecipient" resultMap="BaseResultMap" parameterType="com.evergrande.qms.vo.QmsUserVo" >
    select
    id, login_name, real_name, mobile, email, status, department, power_type, sys_power, is_admin,
    create_user, create_date, update_user, update_date, institute_code, institute_name
    from qms_user u
    <where>
      <if test="realName != null and realName != ''">
        and u.real_name like concat('%', #{realName,jdbcType=VARCHAR},'%')
      </if>
    </where>
  </select>
</mapper>